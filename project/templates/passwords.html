{% extends "base.html" %}

{% block content %}

<style>
  h1 {
    padding-bottom: 40px;
  }

  h2 {}

  .hero-body {
    display: flex;
    flex-direction: column;
  }

  .main-div {
    padding-inline-end: 0px;
  }

  .pass-div {}

  .shared-div {
    padding-top: 50px;
  }
</style>
{% with messages = get_flashed_messages(category_filter=["critical_message"]) %}
{% if messages %}
<article class="message is-danger">
  <div class="message-header">
    <p>Error</p>
    <button class="delete" id="messageDelete" aria-label="delete"></button>
  </div>
  <div class="message-body">
    {{ messages[0] }}
  </div>
</article>
{% endif %}
{% endwith %}

{% with messages = get_flashed_messages(category_filter=["positive_message"]) %}
{% if messages %}
<article class="message is-success">
  <div class="message-header">
    <p>Success</p>
    <button class="delete" id="messageDelete" aria-label="delete"></button>
  </div>
  <div class="message-body">
    {{ messages[0] }}
  </div>
</article>
{% endif %}
{% endwith %}

<div class="hero-body">
  <div class="main-div">
    <h1 class="title has-text-left">
      Manage your passwords for services!
    </h1>
    <a class="btn" data-toggle="modal" href="#newPassword">launch</a>
    <h1>
      {{ name }}
    </h1>
  </div>
  <div class="pass-div">
    <h2 class="title">
      Your passwords:
    </h2>
    <a class="button is-medium is-fullwidth is-info modal-button" data-target="#newPassword">New Password</a>
    <hr>
    <table class='table is-bordered is-hoverable'>
      <thead>
        <tr>
          <th>Owner email</th>
          <th>Name</th>
          <th>Password</th>
          <th>Shared with</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in user_passwords %}
        <tr>
          <td>{{ row['owner'] }}</td>
          <td>{{ row['name'] }}</td>
          <td>{{ row['shared'] }}</td>
          <td>{{ row['password'] }}</td>
          <td>
            <button class="button is-info">Decrypt</button>
            <button class="button is-info">Share</button>
            <a href="{{ url_for('main.delete',id=row['id']) }}"><button class="button is-danger">Delete</button></a>
          </td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
  </div>

  <div class="shared-div">
    <h2 class="title">
      Shared with you:
    </h2>
  </div>
</div>

<div class="modal" id="newPassword">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">New Password</p>
      <button class="modal-close" aria-label="close"></button>
    </header>

    <section class="modal-card-body">
      <div id="passModalDiv" style="padding-bottom: 10px;">
        {% with messages = get_flashed_messages(category_filter=["error"]) %}
        {% if messages %}
        <div class='notification is-danger' id='modalInputError'>
          {{ messages[0] }}
        </div>
        {% endif %}
        {% endwith %}
      </div>
      <form method="POST" id="newPasswordForm" action="/passwords">
        <div class="field">
          <div class="control">
            <input class="input is-large" type="text" name="name" id="nameInput" placeholder="Name e.g. Youtube"
              autofocus="">
          </div>
        </div>

        <div class="field">
          <div class="control">
            <input class="input is-large" type="password" name="password" id="passwordInput" placeholder="Password"
              autofocus="">
          </div>
        </div>

        <div class="field">
          <div class="control">
            <input class="input is-large" type="password" name="secret" id="secretInput" placeholder="Secret Key"
              autofocus="">
          </div>
        </div>
      </form>
    </section>
    <footer class="modal-card-foot">
      <button class="button is-success" id="addPassBtn">Add</button>
      <button class="button is-danger modal-close-button" id="closebtn">Cancel</button>
    </footer>
  </div>

  <script>

    if ($("#modalInputError").length != 0) {
      $(".modal").addClass("is-active");
    }

    $(".modal-button").click(function () {
      $(".modal").addClass("is-active");
    });

    $(".modal-close").click(function () {
      $(".modal").removeClass("is-active");
      if ($("#modalInputError").length != 0) {
        $("#modalInputError").remove()
      }
    });

    $("#messageDelete").click(function () {
      $(".message").remove();
    });

    $(".modal-close-button").click(function () {
      $(".modal").removeClass("is-active");
      if ($("#modalInputError").length != 0) {
        $("#modalInputError").remove()
      }
    });

    $("#addPassBtn").click(function () {
      if ($.trim($("#nameInput").val()) === "" || $.trim($("#passwordInput").val()) === ""
        || $.trim($("#secretInput").val()) === "") {
      }
      //alert('Some fields are empty!');
      //     if($("#modalInputEmpty").length == 0) {
      //       $("#passModalDiv").append("<div class='notification is-danger' id='modalInputEmpty'>Some fileds are empty!</div>")
      //     }
      //     return false;
      // }
      $('form#newPasswordForm').submit();
    });



  </script>

  {% endblock %}